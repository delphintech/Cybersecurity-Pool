# Nom du projet
NAME = vaccine

# R√©pertoire de l'environnement virtuel
VENV = venv
PYTHON = $(VENV)/bin/python
PIP = $(VENV)/bin/pip

# Bash et prompt definition
SHELL := /bin/bash
PROMPT := \[\e[1;36m\](venv)\[\e[0m\] \W \$$

# R√©pertoire du code source
SRC_DIR = srcs

# Fichier principal √† ex√©cuter
MAIN = $(SRC_DIR)/main.py

# Couleur
COLOR = \e[1;92m
RESET = \e[0m

# ===========================================================
# Commandes principales
# ===========================================================

# Par d√©faut : cr√©er l'environnement et lancer le projet
all: $(NAME)

# Cr√©er l'ex√©cutable wrapper
$(NAME): $(VENV) install $(MAIN)
	@printf "üî® Creating executable wrapper...\n"
	@echo '#!/bin/bash' > $(NAME)
	@echo 'DIR="$$(cd "$$(dirname "$${BASH_SOURCE[0]}")" && pwd)"' >> $(NAME)
	@echo 'source "$$DIR/$(VENV)/bin/activate"' >> $(NAME)
	@echo 'python "$$DIR/$(MAIN)" "$$@"' >> $(NAME)
	@chmod +x $(NAME)
	@printf "$(COLOR)"
	@printf "‚ñó‚ññ  ‚ñó‚ññ ‚ñó‚ñÑ‚ññ  ‚ñó‚ñÑ‚ñÑ‚ññ ‚ñó‚ñÑ‚ñÑ‚ññ‚ñó‚ñÑ‚ñÑ‚ñÑ‚ññ‚ñó‚ññ  ‚ñó‚ññ‚ñó‚ñÑ‚ñÑ‚ñÑ‚ññ\n"
	@printf "‚ñê‚ñå  ‚ñê‚ñå‚ñê‚ñå ‚ñê‚ñå‚ñê‚ñå   ‚ñê‚ñå     ‚ñà  ‚ñê‚ñõ‚ñö‚ññ‚ñê‚ñå‚ñê‚ñå   \n"
	@printf "‚ñê‚ñå  ‚ñê‚ñå‚ñê‚ñõ‚ñÄ‚ñú‚ñå‚ñê‚ñå   ‚ñê‚ñå     ‚ñà  ‚ñê‚ñå ‚ñù‚ñú‚ñå‚ñê‚ñõ‚ñÄ‚ñÄ‚ñò\n"
	@printf " ‚ñù‚ñö‚ñû‚ñò ‚ñê‚ñå ‚ñê‚ñå‚ñù‚ñö‚ñÑ‚ñÑ‚ññ‚ñù‚ñö‚ñÑ‚ñÑ‚ññ‚ñó‚ñÑ‚ñà‚ñÑ‚ññ‚ñê‚ñå  ‚ñê‚ñå‚ñê‚ñô‚ñÑ‚ñÑ‚ññ"
	@printf "$(RESET)\n"

# pour lancer le shell de l'environnement
activate: $(VENV)
	@printf "üíª Activating virtual environment ...\n"
	@source $(VENV)/bin/activate && PS1='$(PROMPT)  ' bash --norc

# 1Ô∏è‚É£ Cr√©er et activer l'environnement virtuel
$(VENV):
	@printf "üõ†Ô∏è Creating virtual environment ... \n"
	@test -d $(VENV) || python3 -m venv $(VENV)
	@$(PIP) install --upgrade pip

# Installe les d√©pendances (utile si on modifie requirements.txt)
install: $(VENV)
	@printf "üì¶ Installing dependencies ... \n"
	@if [ -f requirements.txt ]; then $(PIP) install -r requirements.txt; fi

# Supprime les fichiers temporaires et l'environnement virtuel
clean: 
	@printf "üßπ Cleaning ...\n"
	@rm -rf $(VENV) $(NAME)
	@find . -type d -name "__pycache__" -exec rm -rf {} +

# Relance tout depuis z√©ro
re: clean all

# Lance la norme
norm: $(VENV)
	@$(VENV)/bin/flake8 $(SRC_DIR) --exclude=$(VENV),__pycache__

test: $(NAME)
	./$(NAME) -X POST 'http://testphp.vulnweb.com/login.php'
	

.PHONY: activate install run clean re

